<div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-md">
    <h1 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-4">إضافة منتج جديد</h1>

    <form [formGroup]="productForm" (ngSubmit)="addProduct()" class="space-y-6">
        <div>
            <label for="name" class="block text-sm font-medium text-gray-700">اسم المنتج</label>
            <input type="text" id="name" formControlName="name"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm"
                placeholder="مثال: هاتف ذكي">
        </div>

        <div>
            <label for="description" class="block text-sm font-medium text-gray-700">وصف المنتج</label>
            <textarea id="description" formControlName="description" rows="4"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm"
                placeholder="اكتب وصفاً جذاباً لمنتجك..."></textarea>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="price" class="block text-sm font-medium text-gray-700">السعر </label>
                <input type="number" id="price" formControlName="price"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm"
                    placeholder="أدخل سعر المنتج بالجنيه">
            </div>
            <div>
                <label for="quantity" class="block text-sm font-medium text-gray-700"> الكمية</label>
                <input type="number" id="quantity" formControlName="quantity"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm"
                    placeholder="أدخل الكمية المتاحة من المنتج">
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="category" class="block text-sm font-medium text-gray-700">قسم المنتج</label>
                <div class="relative mt-1 category-select-container">
                    <button type="button" (click)="toggleCategoryDropdown()" aria-haspopup="listbox"
                        [attr.aria-expanded]="isCategoryDropdownOpen()"
                        class="relative w-full cursor-default rounded-md border border-gray-300 bg-white py-2 ps-3 pe-10 text-right shadow-sm focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500 sm:text-sm">
                        <span class="block truncate" [class.text-gray-500]="!productForm.get('categoryId')?.value">
                            {{ selectedCategoryName() }}
                        </span>
                        <span class="pointer-events-none absolute inset-y-0 left-0 flex items-center ps-2">
                            <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd"
                                    d="M10 3a.75.75 0 01.53.22l3.5 3.5a.75.75 0 01-1.06 1.06L10 4.81 6.53 8.28a.75.75 0 01-1.06-1.06l3.5-3.5A.75.75 0 0110 3zm-3.72 9.28a.75.75 0 011.06 0L10 15.19l3.47-3.47a.75.75 0 111.06 1.06l-4 4a.75.75 0 01-1.06 0l-4-4a.75.75 0 010-1.06z"
                                    clip-rule="evenodd" />
                            </svg>
                        </span>
                    </button>

                    @if (isCategoryDropdownOpen()) {
                    <div
                        class="absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
                        <div class="p-2">
                            <input type="text" [value]="categorySearchTerm()" (input)="onCategorySearch($event)"
                                placeholder="ابحث عن قسم..."
                                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm">
                        </div>
                        <ul tabindex="-1" role="listbox" class="max-h-60 overflow-auto py-1 text-base sm:text-sm">
                            @for (category of filteredCategories(); track category.id) {
                            <li (click)="selectCategory(category)" role="option"
                                class="group text-gray-900 relative cursor-default select-none py-2 ps-10 pe-3 hover:bg-teal-600 hover:text-white">
                                <span class="font-normal block truncate">{{ category.name }}</span>
                                @if (productForm.get('categoryId')?.value === category.id) {
                                <span
                                    class="text-teal-600 absolute inset-y-0 left-0 flex items-center ps-3 group-hover:text-white">
                                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                        fill="currentColor" aria-hidden="true">
                                        <path fill-rule="evenodd"
                                            d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.052-.143z"
                                            clip-rule="evenodd" />
                                    </svg>
                                </span>
                                }
                            </li>
                            } @empty {
                            <li class="text-gray-500 relative cursor-default select-none py-2 ps-3 pe-3">
                                لا توجد نتائج مطابقة
                            </li>
                            }
                        </ul>
                    </div>
                    }
                </div>
            </div>
 <div>
        <label for="status" class="block text-sm font-medium text-gray-700">حالة المنتج</label>
        <div class="relative mt-1">
            <select id="status" formControlName="statusId"
                class="block w-full appearance-none rounded-md border border-gray-300 bg-white py-2 ps-3 pe-10 text-right shadow-sm focus:outline-none focus:ring-1 focus:ring-teal-500 focus:border-teal-500 sm:text-sm">
                <option [ngValue]="null" disabled selected>اختر حالة المنتج</option>
                @for (item of status(); track item.id) {
                  <option class="text-gray-900 hover:bg-teal-600 hover:text-white" [value]="item.id">{{ item.name }}</option>
                }
            </select>
            <span class="pointer-events-none absolute inset-y-0 left-0 flex items-center ps-2">
                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M10 3a.75.75 0 01.53.22l3.5 3.5a.75.75 0 01-1.06 1.06L10 4.81 6.53 8.28a.75.75 0 01-1.06-1.06l3.5-3.5A.75.75 0 0110 3zm-3.72 9.28a.75.75 0 011.06 0L10 15.19l3.47-3.47a.75.75 0 111.06 1.06l-4 4a.75.75 0 01-1.06 0l-4-4a.75.75 0 010-1.06z" clip-rule="evenodd"></path>
                </svg>
            </span>
        </div>
        
      </div>
        </div>
        <div>
            <label for="image" class="block text-sm font-medium text-gray-700">صورة المنتج</label>
            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                <div class="space-y-1 text-center">
                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48"
                        aria-hidden="true">
                        <path
                            d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <div class="flex text-sm text-gray-600">
                        <label for="file-upload"
                            class="relative cursor-pointer bg-white rounded-md font-medium text-teal-600 hover:text-teal-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-teal-500">
                            <span>ارفع ملف</span>
                            <input id="file-upload" (change)="onFileSelected($event)" name="file-upload" type="file"
                                class="sr-only">
                        </label>
                    </div>
                    @if(idUploaded()) {
                    <p class="text-sm text-green-600">{{ fileName() }}</p>
                    } @else {
                    <p class="text-xs text-gray-500">PNG, JPG, PDF</p>
                    }
                </div>
            </div>
        </div>
        <input type="hidden" formControlName="sellerId" [value]="sellerId()" />

        <div>
            <button type="submit" [disabled]="productForm.invalid"
                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 disabled:bg-gray-400 disabled:cursor-not-allowed">
                إضافة المنتج
            </button>
        </div>
    </form>
</div>